package com.smartform.backend.smartformbackend.template;

import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import org.apache.tomcat.util.json.JSONParser;
import org.bson.Document;
import org.json.JSONArray;
import org.json.JSONObject;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.data.mongodb.core.MongoTemplate;
import org.springframework.stereotype.Component;

import com.fasterxml.jackson.databind.ObjectMapper;

@Component
@Order(3)
public class TemplateService implements CommandLineRunner {

    @Autowired
    private MongoTemplate mongoTemplate;

    @Override
    public void run(String... args) throws Exception {
        // Setting up default templates for given 3 forms
        List<Template> templateList = mongoTemplate.findAll(Template.class);
        // NEW VENDOR ASSESSMENT FORM Form
        var template1 = "{\n  \"_id\": {\n    \"$oid\": \"64283db30c68a41b4a70470a\"\n  },\n  \"details\": {\n    \"templateInfo\": {\n      \"templateName\": \"New Vendor Assessment Form\",\n      \"templateDesc\": \"New Vendor Assessment Form\"\n    },\n    \"templateContents\": [\n      {\n        \"vendor\": [\n          {\n            \"type\": \"header\",\n            \"order\": 0,\n            \"text\": \"New Vendor Assessment Form\",\n            \"style\": \"h1\",\n            \"required\": true\n          },\n          {\n            \"type\": \"text\",\n            \"order\": 1,\n            \"text\": \"Company's Name: \",\n            \"required\": true\n          },\n          {\n            \"type\": \"number\",\n            \"order\": 2,\n            \"text\": \"Company Registration No: \",\n            \"required\": true\n          },\n          {\n            \"type\": \"text\",\n            \"order\": 3,\n            \"text\": \"Office Address: \",\n            \"required\": true\n          },\n          {\n            \"type\": \"boolean\",\n            \"order\": 4,\n            \"text\": \"GST Registered: \",\n            \"options\": [\n              \"Yes\",\n              \"No\"\n            ],\n            \"required\": true\n          },\n          {\n            \"type\": \"number\",\n            \"order\": 5,\n            \"text\": \"Tel: \",\n            \"required\": true\n          },\n          {\n            \"type\": \"number\",\n            \"order\": 6,\n            \"text\": \"Fax: \",\n            \"required\": true\n          },\n          {\n            \"type\": \"checkbox\",\n            \"order\": 7,\n            \"text\": \"Type of business license / Registration\",\n            \"options\": [\n              \"a. Sole Proprietorship\",\n              \"b. Limited Company\",\n              \"c. Partnership Agreement\",\n              \"d. Others\"\n            ],\n            \"required\": true,\n            \"shortAnswer\": true\n          },\n          {\n            \"type\": \"header\",\n            \"order\": 8,\n            \"text\": \"Contact Person: \",\n            \"style\": \"h1\",\n            \"required\": true\n          },\n          {\n            \"type\": \"text\",\n            \"order\": 9,\n            \"text\": \"Name: \",\n            \"required\": true\n          },\n          {\n            \"type\": \"number\",\n            \"order\": 10,\n            \"text\": \"Tel: \",\n            \"required\": true\n          },\n          {\n            \"type\": \"text\",\n            \"order\": 11,\n            \"text\": \"Designation: \",\n            \"required\": true\n          },\n          {\n            \"type\": \"checkbox\",\n            \"order\": 12,\n            \"text\": \"Nature of Business: \",\n            \"options\": [\n              \"Manufacturing\",\n              \"Agent / Dealer\",\n              \"Distributor\",\n              \"Others\"\n            ],\n            \"required\": true,\n            \"shortAnswer\": true\n          },\n          {\n            \"type\": \"text\",\n            \"order\": 13,\n            \"text\": \"Product / Services: \",\n            \"required\": true\n          }\n        ]\n      },\n      {\n        \"admin\": [\n          {\n            \"type\": \"header\",\n            \"order\": 0,\n            \"text\": \"New Vendor Assessment Form\",\n            \"style\": \"h1\",\n            \"required\": true\n          },\n          {\n            \"type\": \"checkbox\",\n            \"order\": 1,\n            \"text\": \"Evaluation\",\n            \"options\": [\n              \"ISO 9001 Certification: \",\n              \"Accreditation of Laboratory: \",\n              \"Product Certification: \",\n              \"Site Evaluation Results: \",\n              \"Results of Samples / Product Evaluation: \",\n              \"Results of First Deal:\",\n              \"Track Record Review / Customer Reference: \",\n              \"Others (e.g. commercial, sole supplier, customer specified, franchise etc.)\"\n            ],\n            \"required\": true,\n            \"shortAnswer\": true\n          },\n          {\n            \"type\": \"radio\",\n            \"order\": 2,\n            \"text\": \"Result of Evaluation: \",\n            \"options\": [\n              \"Approved\",\n              \"Not Approved\"\n            ],\n            \"required\": true\n          },\n          {\n            \"type\": \"text\",\n            \"order\": 3,\n            \"text\": \"Evaluated By: \",\n            \"required\": true\n          },\n          {\n            \"type\": \"text\",\n            \"order\": 4,\n            \"text\": \"Approved By: \",\n            \"required\": true\n          },\n          {\n            \"type\": \"date\",\n            \"order\": 5,\n            \"text\": \"Effective Date\",\n            \"required\": true\n          }\n        ]\n      }\n    ]\n  },\n  \"_class\": \"com.smartform.backend.smartformbackend.template.Template\"\n}";
        // SUBCONTRACTOR’S SAFETY & HEALTH PRE-EVALUATION Form
        var template2 = "{\"_id\": {  \"$oid\": \"642548e8483a524a34d9867e\"},\"details\": {  \"templateInfo\": {    \"templateName\": \"SUBCONTRACTOR’S SAFETY & HEALTH PRE-EVALUATION\",    \"templateDesc\": \"SUBCONTRACTOR’S SAFETY & HEALTH PRE-EVALUATION\"  },  \"templateContents\": [    {      \"vendor\": [        {          \"type\": \"text\",          \"order\": 0,          \"text\": \"Name of Sub-Contractor\",          \"required\": true        },        {          \"type\": \"text\",          \"order\": 1,          \"text\": \"Scope of Work\",          \"required\": true        },        {          \"type\": \"text\",          \"order\": 2,          \"text\": \"Evaluated By\",          \"required\": true        },        {          \"type\": \"date\",          \"order\": 3,          \"text\": \"Date\",          \"required\": true        },        {          \"type\": \"header\",          \"order\": 4,          \"text\": \"Safety & Health Policy and Organisation\",          \"style\": \"h3\",          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 5,          \"text\": \" Is there a written Safety & Health Policy?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 6,          \"text\": \"Is there a Safety Organisation with proper delegation of responsibility and accountability for safety and health?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 7,          \"text\": \"Is there a written safety commitment and is it submitted?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"header\",          \"order\": 8,          \"text\": \"Tool Box Meeting\",          \"style\": \"h3\",          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 9,          \"text\": \"Are regular tool-box meetings conducted and reports submitted?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"header\",          \"order\": 10,          \"text\": \"Safety Training\",          \"style\": \"h3\",          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 11,          \"text\": \"Are relevant safety training courses provided for management / Supervisors?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 12,          \"text\": \"Are relevant safety training courses provided for workers?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 13,          \"text\": \"Are relevant safety training certificates submitted?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"header\",          \"order\": 14,          \"text\": \"Safety & Health Rules & Safe Work Procedures/ Risk Assessment\",          \"style\": \"h3\",          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 15,          \"text\": \"Are there written safety & health rules for the workers?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 16,          \"text\": \"Are there written safe work procedures/ risk assessment formulated and submitted?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"header\",          \"order\": 17,          \"text\": \"Safety & Health Inspection & Equipment\",          \"style\": \"h3\",          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 18,          \"text\": \"Is there a written programme outlining inspection guidelines, frequency and follow-up corrective actions?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 19,          \"text\": \"Is there available Personal Protective Equipment and of proper working condition and comply to safety requirements?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"header\",          \"order\": 20,          \"text\": \"Responsible Personnel\",          \"style\": \"h3\",          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 21,          \"text\": \"Is there a Safety Supervisor working at least 5 hrs / week?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 22,          \"text\": \"Is there a qualified First Aider?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"boolean\",          \"order\": 23,          \"text\": \"Are there relevant Licensed Electrical Workers, qualified engineers, qualified supervisors, lifting supervisors, qualified JCB Tower / Mobile / Crawler Crane operators?\",          \"options\": [            \"Yes\",            \"No\"          ],          \"required\": true        },        {          \"type\": \"header\",          \"order\": 24,          \"text\": \"Accident Analysis\",          \"style\": \"h1\",          \"required\": true        },        {          \"type\": \"number\",          \"order\": 25,          \"text\": \"Accident Records for the last three years: Number of Temporary Disability Cases\",          \"required\": true        },        {          \"type\": \"number\",          \"order\": 26,          \"text\": \"Accident Records for the last three years: Number of Permanent Disability Cases\",          \"required\": true        },        {          \"type\": \"number\",          \"order\": 27,          \"text\": \"Accident Records for the last three years: Number of Fatal Cases\",          \"required\": true        },        {          \"type\": \"acknowledgement\",          \"required\": true        }      ]    }  ]},\"_class\": \"com.smartform.backend.smartformbackend.template.Template\"}";
        // SUBCONTRACTOR’S SAFETY & HEALTH PERFORMANCE EVALUATION Form
        var template3 = "{\"_id\": {    \"$oid\": \"642668c6a9d5757cbb651443\"  },  \"details\": {    \"templateInfo\": {      \"templateName\": \"SUBCONTRACTOR’S SAFETY & HEALTH PERFORMANCE EVALUATION\",      \"templateDesc\": \"SUBCONTRACTOR’S SAFETY & HEALTH PERFORMANCE EVALUATION\"    },    \"templateContents\": [      {        \"vendor\": [          {            \"type\": \"text\",            \"order\": 0,            \"text\": \"Name of Contractor:\",            \"required\": true          },          {            \"type\": \"text\",            \"order\": 1,            \"text\": \"Trade:\",            \"required\": true          },          {            \"type\": \"text\",            \"order\": 2,            \"text\": \"Project / Worksite:\",            \"required\": true          },          {            \"type\": \"date\",            \"order\": 3,            \"text\": \"Date of Evaluation:\",            \"required\": true          },          {            \"type\": \"likertGroup\",            \"order\": 5,            \"text\": \"Part I: Participation in safety\",            \"options\": [              \"1. Attendance in Safety Meeting\",              \"2. Tool Box Meeting\",              \"3. Compliance To Rules & Regulation\",              \"4. Safety Promotional Activities\",              \"5. Document Submission\"            ],            \"required\": true          },          {            \"type\": \"likertGroup\",            \"order\": 5,            \"text\": \"Part II: Safety Training and Competencies (Percentage of Attendence)\",            \"options\": [              \"6. Statutory Safety Training Course\",              \"7. Safety Trade Course\",              \"8. Mass Safety Talk\",              \"9. WSH Safety Coordinator / Supervisor\",              \"10. Other Safety Training\"            ],            \"required\": true          },          {            \"type\": \"likertGroup\",            \"order\": 6,            \"text\": \"Part III: Accident / Incident Preview\",            \"options\": [              \"11. Effort in Accident Prevention\",              \"12. Safe Work Practice / Permit To Work\",              \"13. Incident Severity & Frequency Rate\",              \"14. Safety Offence\",              \"15. Safety Inspection And Rectification\"            ],            \"required\": true          },          {            \"type\": \"likertGroup\",            \"order\": 7,            \"text\": \"Part IV: Maintenance of Equipment\",            \"options\": [              \"16. Explosive Powered Tool / Cutting Tool\",              \"17. Ladder\",              \"18. Lifting Gear / Appliance / Machine\",              \"19. Electrical Equipment / Compressor\",              \"20. Other Machineries\"            ],            \"required\": true          },          {            \"type\": \"likertGroup\",            \"order\": 8,            \"text\": \"Part V: General Housekeeping & Others\",            \"options\": [              \"21. Subcon Snr Mgt Commitment to HS\",              \"22. Compliance with PPE\",              \"23. Housekeeping & Cleanliness at Site\",              \"24. Housekeeping & Cleanliness at Store\",              \"25. Housekeeping & Cleanliness at Quarter\"            ],            \"required\": true          },          {            \"type\": \"text\",            \"order\": 9,            \"text\": \"Comments\",            \"required\": true          },          {            \"type\": \"header\",            \"order\": 10,            \"text\": \"Evaluation Done By:\",            \"style\": \"h1\",            \"required\": true          },          {            \"type\": \"text\",            \"order\": 11,            \"text\": \"Name of Safety Coordinator:\",            \"required\": true          },          {            \"type\": \"date\",            \"order\": 12,            \"text\": \"Date:\",            \"required\": true          }        ]      },      {        \"admin\": [          {            \"type\": \"header\",            \"order\": 0,            \"text\": \"Approved By:\",            \"style\": \"h1\",            \"required\": true          },          {            \"type\": \"text\",            \"order\": 1,            \"text\": \"Name of Director:\",            \"required\": true          },          {            \"type\": \"date\",            \"order\": 2,            \"text\": \"Date:\",            \"required\": true          }        ]      }    ]  },  \"_class\": \"com.smartform.backend.smartformbackend.template.Template\"}";
        Document template1Doc = Document.parse(template1);
        Document template2Doc = Document.parse(template2);
        Document template3Doc = Document.parse(template3);
        // If template database empty, load form templates
        if (templateList.size() == 0) {
            mongoTemplate.insert(template1Doc, "templates");
            mongoTemplate.insert(template2Doc, "templates");
            mongoTemplate.insert(template3Doc, "templates");
        }
    }
}
